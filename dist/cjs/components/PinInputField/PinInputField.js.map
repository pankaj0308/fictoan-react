{"version":3,"file":"PinInputField.js","sources":["../../../../src/components/PinInputField/PinInputField.tsx"],"sourcesContent":["import React, { createRef, useCallback, useEffect, useState } from \"react\";\n\nimport { Element } from \"../Element/Element\";\nimport { CommonAndHTMLProps, SpacingTypes } from \"../Element/constants\";\nimport { InputField } from \"../Form/InputField/InputField\";\n\nimport { PinInputStyled } from \"./PinInputField.styled\";\n\n// prettier-ignore\ntype PinInputFieldCustomProps = {\n    numberOfFields   : number;\n    onChange       ? : (value : string) => void;\n    type           ? : \"alphanumeric\" | \"number\";\n    mask           ? : boolean;\n    otp            ? : boolean;\n    autoFocus      ? : boolean;\n    spacing        ? : SpacingTypes;\n};\n\nexport type PinInputFieldElementType = HTMLDivElement;\nexport type PinInputFieldProps = Omit<CommonAndHTMLProps<PinInputFieldElementType>, keyof PinInputFieldCustomProps> &\n    PinInputFieldCustomProps;\n\nfunction validate(value: string, type: \"alphanumeric\" | \"number\") {\n    const NUMERIC_REGEX = /^[0-9]+$/;\n    const ALPHA_NUMERIC_REGEX = /^[a-zA-Z0-9]+$/i;\n    const regex = type === \"alphanumeric\" ? ALPHA_NUMERIC_REGEX : NUMERIC_REGEX;\n    return regex.test(value);\n}\n\nexport const PinInputField = React.forwardRef(\n    (\n        {\n            numberOfFields: length,\n            onChange,\n            type = \"number\",\n            mask = false,\n            otp = false,\n            autoFocus = false,\n            spacing = \"small\",\n        }: PinInputFieldProps,\n        ref: React.Ref<PinInputFieldElementType>\n    ) => {\n        const [inputRefs, setInputRefs] = useState<React.RefObject<HTMLInputElement>[]>([]);\n        const [values, setValues] = useState<string[]>([]);\n        const [moveFocus, setMoveFocus] = useState<boolean>(true);\n        const [focusedIndex, setFocusedIndex] = useState<number>(-1);\n\n        const focus = useCallback(\n            (index: number) => {\n                const ref = inputRefs[index];\n                ref?.current?.focus();\n            },\n            [inputRefs]\n        );\n\n        useEffect(() => {\n            setInputRefs((inputRefs) => {\n                const refs = Array(length)\n                    .fill(0)\n                    .map((_, i) => {\n                        const ref = inputRefs[i] || createRef();\n                        if (autoFocus && i === 0) {\n                            ref.current?.focus();\n                        }\n                        return ref;\n                    });\n                return refs;\n            });\n        }, [length, autoFocus]);\n\n        const focusNext = useCallback(\n            (index: number) => {\n                if (!moveFocus) return;\n                const next = index + 1 < length ? index + 1 : null;\n                if (next) {\n                    focus(next);\n                }\n            },\n            [focus, length, moveFocus]\n        );\n\n        const setValue = useCallback(\n            (value: string, index: number) => {\n                const nextValues = [...values];\n                nextValues[index] = value;\n                setValues(nextValues);\n                onChange?.(nextValues.join(\"\"));\n\n                const isComplete =\n                    value !== \"\" &&\n                    nextValues.length === length &&\n                    nextValues.every((inputValue) => inputValue != null && inputValue !== \"\");\n\n                if (!isComplete) {\n                    focusNext(index);\n                }\n            },\n            [focusNext, length, onChange, values]\n        );\n\n        const getNextValue = useCallback((value: string, eventValue: string) => {\n            let nextValue = eventValue;\n            if (value?.length > 0) {\n                if (value[0] === eventValue.charAt(0)) {\n                    nextValue = eventValue.charAt(1);\n                } else if (value[0] === eventValue.charAt(1)) {\n                    nextValue = eventValue.charAt(0);\n                }\n            }\n            return nextValue;\n        }, []);\n\n        const handleInputChange = (event: React.FormEvent<HTMLInputElement>, i: number) => {\n            const eventValue = event.currentTarget.value;\n            const currentValue = values[i];\n            const nextValue = getNextValue(currentValue, eventValue);\n\n            if (nextValue === \"\") {\n                setValue(\"\", i);\n                return;\n            }\n\n            if (eventValue.length > 1 && i < length - 1) {\n                if (validate(eventValue, type)) {\n                    const nextValue = eventValue.split(\"\").filter((_, index) => index < length);\n                    setValues(nextValue);\n                    focus(i + nextValue.length < length ? i + nextValue.length : length - 1);\n                    onChange?.(nextValue.join(\"\"));\n                }\n            } else {\n                if (validate(nextValue, type)) {\n                    setValue(nextValue, i);\n                }\n                setMoveFocus(true);\n            }\n        };\n\n        const onKeyDown = (event: React.KeyboardEvent, i: number) => {\n            if (event.key === \"Backspace\") {\n                if ((event.target as HTMLInputElement).value === \"\") {\n                    if (i > 0) {\n                        const newIndex = i - 1;\n                        setValue(\"\", newIndex);\n                        focus(newIndex);\n                        setMoveFocus(true);\n                    }\n                } else {\n                    setMoveFocus(false);\n                }\n            } else if (event.key === \"Escape\") {\n                inputRefs[i].current?.blur();\n                onBlur();\n            } else if (event.key === \"ArrowRight\") {\n                if (i < length - 1) {\n                    focus(i + 1);\n                }\n            } else if (event.key === \"ArrowLeft\") {\n                if (i > 0) {\n                    focus(i - 1);\n                }\n            }\n        };\n\n        const onFocus = (e: React.FocusEvent<HTMLInputElement>, i: number) => {\n            setFocusedIndex(i);\n            setTimeout(() => {\n                // https://github.com/facebook/react/issues/6483\n                e.target.setSelectionRange(e.target.value.length, e.target.value.length);\n            }, 0);\n        };\n\n        const onBlur = () => {\n            setFocusedIndex(-1);\n        };\n\n        let classNames = [];\n\n        if (spacing) {\n            classNames.push(`spacing-${spacing}`);\n        }\n\n        return (\n            <Element<PinInputFieldElementType> as={PinInputStyled} classNames={classNames} ref={ref}>\n                {[...Array(length)].map((_, i) => (\n                    <InputField\n                        key={i}\n                        className=\"pin-input-field\"\n                        ref={inputRefs[i]}\n                        type={mask ? \"password\" : type === \"number\" ? \"tel\" : \"text\"}\n                        inputMode={type === \"number\" ? \"numeric\" : \"text\"}\n                        onChange={(e) => handleInputChange(e, i)}\n                        onKeyDown={(e) => onKeyDown(e, i)}\n                        onFocus={(e) => onFocus(e, i)}\n                        onBlur={onBlur}\n                        placeholder={focusedIndex !== i ? `\\u2981` : undefined}\n                        autoComplete={otp ? \"one-time-code\" : \"off\"}\n                        value={values[i] || \"\"}\n                        autoFocus={autoFocus && i === 0}\n                    />\n                ))}\n            </Element>\n        );\n    }\n);\n"],"names":["validate","value","type","test","PinInputField","React","forwardRef","numberOfFields","length","onChange","mask","otp","autoFocus","spacing","ref","inputRefs","setInputRefs","useState","values","setValues","moveFocus","setMoveFocus","focusedIndex","setFocusedIndex","focus","useCallback","index","current","useEffect","Array","fill","map","_","i","createRef","focusNext","next","setValue","nextValues","join","every","inputValue","getNextValue","eventValue","nextValue","charAt","onBlur","classNames","push","Element","as","PinInputStyled","InputField","key","className","inputMode","e","event","currentTarget","currentValue","split","filter","handleInputChange","onKeyDown","target","newIndex","blur","onFocus","setTimeout","setSelectionRange","placeholder","undefined","autoComplete"],"mappings":"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"}